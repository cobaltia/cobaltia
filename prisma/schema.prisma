// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["typedSql", "metrics"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Client {
  id          String   @id @db.VarChar(20)
  bankBalance Decimal  @default(0) @map("bank_balance")
  tax         Decimal  @default(7) @map("tax")
  executives  String[] @default([]) @map("executives")
  ministers   String[] @default([]) @map("ministers")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("client")
}

model Guild {
  id               String   @id @db.VarChar(20)
  logChannelId     String?  @map("log_channel_id") @db.VarChar(20)
  welcomeChannelId String?  @map("welcome_channel_id") @db.VarChar(20)
  voiceChannelId   String?  @map("voice_channel_id") @db.VarChar(20)
  welcomeMessage   String   @default("Welcome to {guild}, {user}!") @map("welcome_message")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("guilds")
}

model User {
  id              String            @id @db.VarChar(20)
  bankBalance     Decimal           @default(0) @map("bank_balance")
  bankLimit       Decimal           @default(1000) @map("bank_limit")
  wallet          Decimal           @default(0) @map("wallet")
  bounty          Decimal           @default(0) @map("bounty")
  experience      Int               @default(0) @map("experience")
  level           Int               @default(0) @map("level")
  socialCredit    Int               @default(1000) @map("social_credit")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @default(now()) @updatedAt @map("updated_at")
  Voice           Voice[]
  BankTransaction BankTransaction[]
  Inventory       Inventory[]

  @@map("users")
}

model Inventory {
  id        String   @id @default(cuid())
  userId    String   @map("user_id") @db.VarChar(20)
  itemId    String   @map("item_id") @db.VarChar(20)
  quantity  Int      @default(0) @map("quantity")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, itemId])
  @@map("inventories")
}

model Voice {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String   @map("user_id") @db.VarChar(20)
  channelId String   @map("channel_id") @db.VarChar(20)
  guildId   String   @map("guild_id") @db.VarChar(20)
  date      DateTime @default(now()) @map("date")
  duration  Int      @default(0) @map("duration")
  earned    Decimal  @default(0) @map("earned")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("voices")
}

model BankTransaction {
  id          String      @id @default(cuid())
  amount      Decimal     @map("amount")
  type        Transaction @map("type")
  description String[]    @map("description")
  account     User        @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId   String      @map("account_id")
  date        DateTime    @default(now()) @map("date")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @default(now()) @updatedAt @map("updated_at")

  @@map("bank_transactions")
}

model Event {
  id        String   @id @default(cuid())
  name      String   @unique() @map("name")
  enabled   Boolean  @default(false) @map("enabled")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("events")
}

enum Transaction {
  DEPOSIT
  WITHDRAW
  TRANSFER
}

enum MoneyReason {
  BOUNTY_CLAIM
  DAILY
  DEATH
  GAMBLING
  ROB
  STORE
  TAX
  VOICE
  WORK
}

enum ExperienceReason {
  MESSAGE
  VOICE
}

enum ItemAction {
  BUY
  SELL
  USE
}

model CommandHistory {
  id        String   @id @default(cuid())
  command   String   @map("command") @db.VarChar(50)
  userId    String   @map("user_id") @db.VarChar(20)
  guildId   String   @map("guild_id") @db.VarChar(20)
  channelId String   @map("channel_id") @db.VarChar(20)
  success   Boolean  @map("success")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([userId])
  @@index([guildId])
  @@map("command_history")
}

model MoneyHistory {
  id        String      @id @default(cuid())
  userId    String      @map("user_id") @db.VarChar(20)
  guildId   String      @map("guild_id") @db.VarChar(20)
  channelId String      @map("channel_id") @db.VarChar(20)
  command   String      @map("command") @db.VarChar(50)
  reason    MoneyReason @map("reason")
  amount    Decimal     @map("amount")
  earned    Boolean     @map("earned")
  createdAt DateTime    @default(now()) @map("created_at")

  @@index([userId])
  @@index([reason])
  @@map("money_history")
}

model ExperienceHistory {
  id        String           @id @default(cuid())
  userId    String           @map("user_id") @db.VarChar(20)
  reason    ExperienceReason @map("reason")
  amount    Int              @map("amount")
  levelUp   Boolean          @default(false) @map("level_up")
  createdAt DateTime         @default(now()) @map("created_at")

  @@index([userId])
  @@index([reason])
  @@map("experience_history")
}

model MessageHistory {
  id        String   @id @default(cuid())
  userId    String   @map("user_id") @db.VarChar(20)
  guildId   String   @map("guild_id") @db.VarChar(20)
  channelId String   @map("channel_id") @db.VarChar(20)
  count     Int      @default(1) @map("count")
  date      DateTime @default(now()) @map("date") @db.Date
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@unique([userId, guildId, channelId, date])
  @@map("message_history")
}

model ItemHistory {
  id        String     @id @default(cuid())
  userId    String     @map("user_id") @db.VarChar(20)
  guildId   String     @map("guild_id") @db.VarChar(20)
  channelId String     @map("channel_id") @db.VarChar(20)
  itemId    String     @map("item_id") @db.VarChar(20)
  action    ItemAction @map("action")
  quantity  Int        @default(1) @map("quantity")
  createdAt DateTime   @default(now()) @map("created_at")

  @@index([userId])
  @@index([itemId])
  @@map("item_history")
}

enum EntityType {
  USER
  GUILD
  CHANNEL
}

enum AuditAction {
  COMMAND_SUCCESS
  COMMAND_ERROR
  MONEY_EARNED
  MONEY_LOST
  EXPERIENCE_GAINED
  LEVEL_UP
  ITEM_BOUGHT
  ITEM_SOLD
  ITEM_USED
  BANK_DEPOSIT
  BANK_WITHDRAW
  BANK_TRANSFER
  SOCIAL_CREDIT_ADDED
  SOCIAL_CREDIT_REMOVED
  GOVERNMENT_ROLE_ADDED
  GOVERNMENT_ROLE_REMOVED
}

model DiscordEntity {
  id        String     @id @db.VarChar(20)
  type      EntityType @map("type")
  name      String     @map("name") @db.VarChar(100)
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @default(now()) @updatedAt @map("updated_at")

  @@index([type])
  @@map("discord_entities")
}

model AuditLog {
  id         String      @id @default(cuid())
  action     AuditAction @map("action")
  userId     String      @map("user_id") @db.VarChar(20)
  guildId    String?     @map("guild_id") @db.VarChar(20)
  channelId  String?     @map("channel_id") @db.VarChar(20)
  targetId   String?     @map("target_id") @db.VarChar(50)
  targetType String?     @map("target_type") @db.VarChar(20)
  metadata   String?     @map("metadata") @db.VarChar(255)
  createdAt  DateTime    @default(now()) @map("created_at")

  @@index([userId])
  @@index([guildId])
  @@index([action])
  @@index([createdAt])
  @@map("audit_log")
}
